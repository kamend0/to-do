<!DOCTYPE html>
<html>
  <head>
    <title>Tasks</title>
  </head>
  <body>
    <h1>Tasks</h1>
    <ul id="task-list">
      {% for task in tasks %}
        <!-- <div id="task_{{ task.id }}"> -->
          <li id="task_{{ task.id }}">{{ task.title }} - {{ task.description }}</li>
          <!-- <p id="del_task_{{ task.id }}" href="del_path"> x </p> -->
          <!-- <p id="edit_task_{{ task.id }}" href="edit_path"> e </p> -->
        <!-- </div> -->
      {% endfor %}
    </ul>
    <form id="add-task-form">
      <input type="text" id="title" name="title" placeholder="Title">
      <input type="text" id="description" name="description" placeholder="Description">
      <button type="submit">Add Task</button>
    </form>
    <script>
      // ADDING TASKS
      var form = document.getElementById('add-task-form');
      var taskList = document.getElementById('task-list');
      var tempNewTaskNum = -1; // Negative to avoid conflicts with real existing IDs
      form.addEventListener('submit', (event) => {
        event.preventDefault();
        const title = document.getElementById('title').value;
        const description = document.getElementById('description').value;
        const data = { title: title, description: description };
        fetch('/tasks', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Create a new HTML element for the task and append it to the task list
            var taskElement = document.createElement('li');

            // Generate new entry with temp id, increment task number *after* rendering
            var tempID = "task_" + tempNewTaskNum--;
            console.log(tempID);
            taskElement.setAttribute('id', tempID);
            taskElement.innerText = `${title} - ${description}`;
            taskList.appendChild(taskElement);

            // Clear out the submit forms
            var formTitle = document.getElementById('title');
            var formDescription = document.getElementById('description');
            formTitle.value = '';
            formDescription.value = '';
          } else {
            alert('Failed to add task: ' + data.message);
          }
        })
        .catch(error => {
          console.error(error);
          alert('An error occurred while adding the task');
        });
      });
    </script>
  </body>
</html>
